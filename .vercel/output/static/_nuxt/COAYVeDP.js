import{h as ee,l as te,n as C,r as U,m as ae,i as ne,c as $,a as d,b as a,w as r,z as I,j as n,g as oe,f as le,p as re,o as N,d as L,k as se,y as ie,t as V}from"./DNOTuklV.js";import{a as de,_ as ce}from"./8hJOxu5z.js";import{_ as me}from"./VnKSk5Dv.js";import{_ as ue}from"./CUyk4a_6.js";import{_ as pe}from"./Lwu6USVw.js";import{_ as _e}from"./WinUwd0k.js";import{_ as fe}from"./BkXjYmYK.js";import{_ as ye}from"./BjgpcN_8.js";import{u as g}from"./DH4W2Tv0.js";import{o as ve,s as k}from"./NeIn7EVK.js";import"./SYmKFyMt.js";import"./4gSLflFa.js";import"./DIOUVaTp.js";import"./QRBWpGKc.js";import"./CAAWyulb.js";import"./DDOLqT6N.js";import"./B7PN2p1L.js";const Ue={class:"space-y-6"},ge={class:"flex justify-between items-center"},xe={class:"flex justify-between items-center"},be={class:"text-lg font-semibold"},we={class:"mb-4 flex gap-4"},he={key:0,class:"flex justify-center py-8"},Ve={class:"text-sm text-gray-900 dark:text-white"},ke={class:"text-lg font-semibold"},Ae={class:"space-y-4"},Ce={class:"flex justify-end space-x-3 mt-6"},Qe=ee({__name:"units",setup(Ie){const{partners:x,units:P,loadPartners:B,loadUnits:F,refreshData:j,isLoading:D}=te(),{createUnit:T,updateUnit:q,deleteUnit:O}=re(),Z=C(()=>D.partners||D.units),A=U(!1),p=U(!1),_=U(null),b=U(""),w=U("name_asc"),z=[{label:"Name A-Z",value:"name_asc"},{label:"Name Z-A",value:"name_desc"},{label:"Partner A-Z",value:"partner_asc"},{label:"Partner Z-A",value:"partner_desc"},{label:"Newest First",value:"created_desc"},{label:"Oldest First",value:"created_asc"}],G=ve({name:k().min(1,"Unit name is required"),partnerId:k().min(1,"Partner is required"),location:k().optional(),notes:k().optional()}),l=ae({name:"",partnerId:"",location:"",notes:""}),Q=[{key:"name",label:"Unit Name"},{key:"partner",label:"Partner"},{key:"location",label:"Location"},{key:"notes",label:"Notes"},{key:"actions",label:""}],R=C(()=>Array.isArray(x.value)?x.value.map(t=>({label:t.name,value:t.id})):[]),h=t=>{if(!Array.isArray(x.value))return"Unknown Partner";const e=x.value.find(f=>f.id===t);return(e==null?void 0:e.name)||"Unknown Partner"},E=C(()=>{if(!Array.isArray(P.value))return[];let t=P.value.filter(s=>{var v,u;const i=b.value.toLowerCase(),c=((v=s.name)==null?void 0:v.toLowerCase())||"",m=h(s.partnerId||s.partner_id).toLowerCase(),y=((u=s.location)==null?void 0:u.toLowerCase())||"";return c.includes(i)||m.includes(i)||y.includes(i)});const[e,f]=w.value.split("_");return t.sort((s,i)=>{let c,m;switch(e){case"name":c=s.name||"",m=i.name||"";break;case"partner":c=h(s.partnerId||s.partner_id),m=h(i.partnerId||i.partner_id);break;case"created":c=new Date(s.createdAt||s.created_at||0),m=new Date(i.createdAt||i.created_at||0);break;default:return 0}if(e==="created")return f==="asc"?c-m:m-c;const y=c.localeCompare(m);return f==="asc"?y:-y}),t}),H=t=>[[{label:"Edit",icon:"i-heroicons-pencil-square",click:()=>J(t)}],[{label:"Delete",icon:"i-heroicons-trash",click:()=>W(t)}]],J=t=>{_.value=t,l.name=t.name,l.partnerId=t.partnerId||t.partner_id,l.location=t.location||"",l.notes=t.notes||"",p.value=!0},M=()=>{p.value=!1,_.value=null,Object.assign(l,{name:"",partnerId:"",location:"",notes:""})},K=async()=>{try{A.value=!0,_.value?(await q(_.value.id,l),g().add({title:"Unit updated",description:`${l.name} has been updated successfully`,color:"green"})):(await T(l),g().add({title:"Unit created",description:`${l.name} has been created successfully`,color:"green"})),await j("units"),M()}catch{g().add({title:"Error",description:"Failed to save unit",color:"red"})}finally{A.value=!1}},W=async t=>{if(confirm(`Are you sure you want to delete "${t.name}"?`))try{await O(t.id),await j("units"),g().add({title:"Unit deleted",description:`${t.name} has been deleted`,color:"orange"})}catch{g().add({title:"Error",description:"Failed to delete unit",color:"red"})}};return ne(async()=>{await Promise.all([B(),F()])}),(t,e)=>{const f=se,s=oe,i=de,c=me,m=ue,y=pe,v=le,u=ce,S=_e,X=fe,Y=ye;return N(),$("div",Ue,[d("div",ge,[e[9]||(e[9]=d("div",null,[d("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Units Management"),d("p",{class:"text-gray-600 dark:text-gray-400"},"Manage property units and their details")],-1)),a(s,{onClick:e[0]||(e[0]=o=>p.value=!0),color:"primary"},{default:r(()=>[a(f,{name:"i-heroicons-plus",class:"mr-2"}),e[8]||(e[8]=L(" Add Unit ",-1))]),_:1,__:[8]})]),a(v,null,{header:r(()=>[d("div",xe,[d("h3",be,"Units ("+V(n(E).length)+")",1)])]),default:r(()=>[d("div",we,[a(i,{modelValue:n(b),"onUpdate:modelValue":e[1]||(e[1]=o=>I(b)?b.value=o:null),placeholder:"Search units...",icon:"i-heroicons-magnifying-glass",class:"flex-1"},null,8,["modelValue"]),a(c,{modelValue:n(w),"onUpdate:modelValue":e[2]||(e[2]=o=>I(w)?w.value=o:null),options:z,class:"w-48"},null,8,["modelValue"])]),n(Z)?(N(),$("div",he,e[10]||(e[10]=[d("div",{class:"text-gray-500"},"Loading units...",-1)]))):(N(),ie(y,{key:1,rows:n(E),columns:Q,class:"min-w-full"},{"partner-data":r(({row:o})=>[d("span",Ve,V(h(o.partnerId||o.partner_id)),1)]),"actions-data":r(({row:o})=>[a(m,{items:H(o)},{default:r(()=>[a(s,{color:"gray",variant:"ghost",icon:"i-heroicons-ellipsis-horizontal",size:"sm"})]),_:2},1032,["items"])]),_:1},8,["rows"]))]),_:1}),a(Y,{modelValue:n(p),"onUpdate:modelValue":e[7]||(e[7]=o=>I(p)?p.value=o:null)},{default:r(()=>[a(v,null,{header:r(()=>[d("h3",ke,V(n(_)?"Edit Unit":"Create Unit"),1)]),default:r(()=>[a(X,{schema:n(G),state:n(l),onSubmit:K},{default:r(()=>[d("div",Ae,[a(u,{label:"Unit Name",name:"name",required:""},{default:r(()=>[a(i,{modelValue:n(l).name,"onUpdate:modelValue":e[3]||(e[3]=o=>n(l).name=o),placeholder:"Enter unit name"},null,8,["modelValue"])]),_:1}),a(u,{label:"Partner",name:"partnerId",required:""},{default:r(()=>[a(c,{modelValue:n(l).partnerId,"onUpdate:modelValue":e[4]||(e[4]=o=>n(l).partnerId=o),options:n(R),placeholder:"Select partner"},null,8,["modelValue","options"])]),_:1}),a(u,{label:"Location",name:"location"},{default:r(()=>[a(S,{modelValue:n(l).location,"onUpdate:modelValue":e[5]||(e[5]=o=>n(l).location=o),placeholder:"Enter unit location"},null,8,["modelValue"])]),_:1}),a(u,{label:"Notes",name:"notes"},{default:r(()=>[a(S,{modelValue:n(l).notes,"onUpdate:modelValue":e[6]||(e[6]=o=>n(l).notes=o),placeholder:"Additional notes"},null,8,["modelValue"])]),_:1})]),d("div",Ce,[a(s,{color:"gray",variant:"ghost",onClick:M},{default:r(()=>e[11]||(e[11]=[L("Cancel",-1)])),_:1,__:[11]}),a(s,{type:"submit",color:"primary",loading:n(A)},{default:r(()=>[L(V(n(_)?"Update":"Create")+" Unit ",1)]),_:1},8,["loading"])])]),_:1},8,["schema","state"])]),_:1})]),_:1},8,["modelValue"])])}}});export{Qe as default};
