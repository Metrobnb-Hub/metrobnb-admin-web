import{h as F,m as Z,l as ee,p as te,r as w,n as c,x as ae,i as oe,y as ne,o as v,w as r,a as l,b as n,j as a,z as se,t as u,c as A,F as le,q as re,s as de,v as ie,g as M,d as C,N as me,f as ue,k as pe}from"./DNOTuklV.js";import{_ as ce,a as be}from"./8hJOxu5z.js";import{_ as ge}from"./VnKSk5Dv.js";import{_ as _e}from"./BRKyBaGh.js";import{_ as ye}from"./WinUwd0k.js";import{_ as xe}from"./DDOLqT6N.js";import{_ as ke}from"./BkXjYmYK.js";import{o as fe,s as i,e as ve,c as N}from"./NeIn7EVK.js";import{u as Ve}from"./C5g50TYT.js";import{u as I}from"./DH4W2Tv0.js";import"./SYmKFyMt.js";import"./DIOUVaTp.js";import"./B7PN2p1L.js";import"./CAAWyulb.js";const Be={class:"space-y-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0"},Se={class:"ml-3 text-sm font-medium text-gray-900 dark:text-white"},Ue={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},he={class:"mt-6"},Ae={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Pe={class:"flex-1"},De={class:"text-sm font-medium text-gray-900 dark:text-white"},we={class:"text-xs text-gray-500 dark:text-gray-400"},Ne={class:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},Ie={class:"flex justify-between items-center"},Fe={class:"text-sm"},Me={key:0,class:"flex justify-between items-center mt-1"},Ce={class:"text-sm"},qe={class:"flex justify-between items-center mt-2 pt-2 border-t border-blue-200 dark:border-blue-800"},Re={class:"font-bold text-lg text-blue-600 dark:text-blue-400"},je={class:"flex justify-between items-center mt-1"},Te={class:"text-sm"},$e={class:"flex justify-between items-center mt-1 pt-1 border-t border-blue-200 dark:border-blue-800"},Oe={class:"flex justify-end mt-6"},Ee=F({__name:"BookingForm",emits:["submit"],setup(q,{emit:V}){const B=[{type:"early_checkin",label:"Early Check-In",amount:300},{type:"late_checkout",label:"Late Check-Out",amount:300},{type:"parking",label:"Parking Fee",amount:200}],S=[{label:"Confirmed",value:"confirmed"},{label:"Canceled",value:"canceled"},{label:"Refunded",value:"refunded"}],y=[{label:"Unpaid",value:"unpaid"},{label:"Partial",value:"partial"},{label:"Fully Paid",value:"fully_paid"}],m=fe({guestName:i().min(1,"Guest name is required"),bookingDate:i().min(1,"Booking date is required"),startDate:i().min(1,"Check-in date is required"),endDate:i().min(1,"Check-out date is required"),amount:N.number().min(.01,"Amount must be greater than 0"),paymentMethod:i().min(1,"Payment method is required"),partner:i().min(1,"Partner is required"),unitId:i().min(1,"Unit is required"),bookingStatus:i().min(1,"Booking status is required"),paymentStatus:i().min(1,"Payment status is required"),amountPaid:N.number().min(0,"Amount paid must be 0 or greater"),paymentReceivedBy:ve(["partner","metrobnb"]),bookingSourceId:i().min(1,"Booking source is required"),notes:i().max(100,"Notes must be 100 characters or less").optional()}),t=Z({guestName:"",bookingDate:"",startDate:"",endDate:"",amount:0,paymentMethod:"",partner:"",unitId:"",addons:[],bookingStatus:"confirmed",paymentStatus:"unpaid",amountPaid:0,paymentReceivedBy:"partner",bookingSourceId:"",notes:""}),{partners:g,units:_,loadPartners:U,loadUnits:R}=ee(),{getBookingSources:j,getPaymentMethods:T}=te(),x=w([]),k=w([]),$=c(()=>!Array.isArray(g.value)||g.value.length===0?[]:g.value.map(o=>({label:o.name,value:o.id}))),O=c(()=>!t.partner||!Array.isArray(_.value)||_.value.length===0?[]:_.value.filter(o=>o&&(o.partnerId||o.partner_id)===t.partner).map(o=>({label:o.name,value:o.id}))),E=c(()=>Array.isArray(k.value)?k.value.filter(o=>o.is_active).map(o=>({label:o.name,value:o.id})):[]),G=c(()=>Array.isArray(x.value)?x.value.filter(o=>o.is_active).map(o=>({label:`${o.name}${o.commission_rate?` (${o.commission_rate}%)`:""}`,value:o.id})):[]),z=V,L=o=>t.addons.some(e=>e.type===o),H=o=>{const e=t.addons.findIndex(p=>p.type===o.type);e>=0?t.addons.splice(e,1):t.addons.push({type:o.type,amount:o.amount})},h=c(()=>t.addons.reduce((o,e)=>o+e.amount,0)),P=c(()=>Number(t.amount||0)+h.value),D=c(()=>P.value-Number(t.amountPaid||0)),f=c({get:()=>t.paymentReceivedBy==="metrobnb",set:o=>{t.paymentReceivedBy=o?"metrobnb":"partner"}});ae(()=>t.partner,()=>{t.unitId=""});const J=()=>{z("submit",{...t}),Object.assign(t,{guestName:"",bookingDate:"",startDate:"",endDate:"",amount:0,paymentMethod:"",partner:"",unitId:"",addons:[],bookingStatus:"confirmed",paymentStatus:"unpaid",amountPaid:0,paymentReceivedBy:"partner",bookingSourceId:"",notes:""})};return oe(async()=>{try{const[,,o,e]=await Promise.all([U(),R(),j(),T()]);x.value=o||[],k.value=e||[]}catch(o){console.error("Failed to load dropdown data:",o),x.value=[],k.value=[]}}),(o,e)=>{const p=be,d=ce,b=ge,K=_e,Q=ye,W=xe,X=M,Y=ke;return v(),ne(Y,{schema:a(m),state:a(t),onSubmit:J},{default:r(()=>[l("div",Be,[n(d,{label:"Guest Name",name:"guestName"},{default:r(()=>[n(p,{modelValue:a(t).guestName,"onUpdate:modelValue":e[0]||(e[0]=s=>a(t).guestName=s)},null,8,["modelValue"])]),_:1}),n(d,{label:"Booking Date",name:"bookingDate"},{default:r(()=>[n(p,{modelValue:a(t).bookingDate,"onUpdate:modelValue":e[1]||(e[1]=s=>a(t).bookingDate=s),type:"date"},null,8,["modelValue"])]),_:1}),n(d,{label:"Check-in Date",name:"startDate"},{default:r(()=>[n(p,{modelValue:a(t).startDate,"onUpdate:modelValue":e[2]||(e[2]=s=>a(t).startDate=s),type:"date"},null,8,["modelValue"])]),_:1}),n(d,{label:"Check-out Date",name:"endDate"},{default:r(()=>[n(p,{modelValue:a(t).endDate,"onUpdate:modelValue":e[3]||(e[3]=s=>a(t).endDate=s),type:"date"},null,8,["modelValue"])]),_:1}),n(d,{label:"Base Amount",name:"amount"},{default:r(()=>[n(p,{modelValue:a(t).amount,"onUpdate:modelValue":e[4]||(e[4]=s=>a(t).amount=s),type:"number",step:"0.01"},null,8,["modelValue"])]),_:1}),n(d,{label:"Payment Method",name:"paymentMethod"},{default:r(()=>[n(b,{modelValue:a(t).paymentMethod,"onUpdate:modelValue":e[5]||(e[5]=s=>a(t).paymentMethod=s),options:a(E)},null,8,["modelValue","options"])]),_:1}),n(d,{label:"Partner",name:"partner"},{default:r(()=>[n(b,{modelValue:a(t).partner,"onUpdate:modelValue":e[6]||(e[6]=s=>a(t).partner=s),options:a($)},null,8,["modelValue","options"])]),_:1}),n(d,{label:"Unit",name:"unitId"},{default:r(()=>[n(b,{modelValue:a(t).unitId,"onUpdate:modelValue":e[7]||(e[7]=s=>a(t).unitId=s),options:a(O),disabled:!a(t).partner,placeholder:"Select a partner first"},null,8,["modelValue","options","disabled"])]),_:1}),n(d,{label:"Booking Status",name:"bookingStatus"},{default:r(()=>[n(b,{modelValue:a(t).bookingStatus,"onUpdate:modelValue":e[8]||(e[8]=s=>a(t).bookingStatus=s),options:S},null,8,["modelValue"])]),_:1}),n(d,{label:"Payment Status",name:"paymentStatus"},{default:r(()=>[n(b,{modelValue:a(t).paymentStatus,"onUpdate:modelValue":e[9]||(e[9]=s=>a(t).paymentStatus=s),options:y},null,8,["modelValue"])]),_:1}),n(d,{label:"Amount Paid",name:"amountPaid"},{default:r(()=>[n(p,{modelValue:a(t).amountPaid,"onUpdate:modelValue":e[10]||(e[10]=s=>a(t).amountPaid=s),type:"number",step:"0.01"},null,8,["modelValue"])]),_:1}),n(d,{label:"Payment Received By",name:"paymentReceivedBy"},{default:r(()=>[n(K,{modelValue:a(f),"onUpdate:modelValue":e[11]||(e[11]=s=>se(f)?f.value=s:null),ui:{active:"bg-blue-500 dark:bg-blue-400"}},null,8,["modelValue"]),l("span",Se,u(a(f)?"MetroBNB":"Partner"),1)]),_:1}),n(d,{label:"Booking Source",name:"bookingSourceId"},{default:r(()=>[n(b,{modelValue:a(t).bookingSourceId,"onUpdate:modelValue":e[12]||(e[12]=s=>a(t).bookingSourceId=s),options:a(G)},null,8,["modelValue","options"])]),_:1}),n(d,{label:"Notes",name:"notes",class:"sm:col-span-2"},{default:r(()=>[n(Q,{modelValue:a(t).notes,"onUpdate:modelValue":e[13]||(e[13]=s=>a(t).notes=s),placeholder:"Additional notes (max 100 characters)",maxlength:100,rows:2},null,8,["modelValue"]),l("div",Ue,u(a(t).notes.length)+"/100 characters ",1)]),_:1})]),l("div",he,[e[14]||(e[14]=l("h4",{class:"text-sm font-medium text-gray-900 dark:text-white mb-3"},"Add-ons",-1)),l("div",Ae,[(v(),A(le,null,re(B,s=>l("div",{key:s.type,class:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800"},[n(W,{"model-value":L(s.type),"onUpdate:modelValue":Le=>H(s)},null,8,["model-value","onUpdate:modelValue"]),l("div",Pe,[l("p",De,u(s.label),1),l("p",we,"₱"+u(s.amount),1)])])),64))])]),l("div",Ne,[l("div",Ie,[e[15]||(e[15]=l("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Base Amount:",-1)),l("span",Fe,"₱"+u(Number(a(t).amount||0).toFixed(2)),1)]),a(h)>0?(v(),A("div",Me,[e[16]||(e[16]=l("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Add-ons:",-1)),l("span",Ce,"₱"+u(a(h).toFixed(2)),1)])):de("",!0),l("div",qe,[e[17]||(e[17]=l("span",{class:"font-medium text-gray-900 dark:text-white"},"Total Amount:",-1)),l("span",Re,"₱"+u(a(P).toFixed(2)),1)]),l("div",je,[e[18]||(e[18]=l("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Amount Paid:",-1)),l("span",Te,"₱"+u(Number(a(t).amountPaid||0).toFixed(2)),1)]),l("div",$e,[e[19]||(e[19]=l("span",{class:"font-medium text-gray-900 dark:text-white"},"Remaining Balance:",-1)),l("span",{class:ie(["font-bold",a(D)>0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"])}," ₱"+u(a(D).toFixed(2)),3)])]),l("div",Oe,[n(X,{type:"submit",color:"primary"},{default:r(()=>e[20]||(e[20]=[C("Save Booking",-1)])),_:1,__:[20]})])]),_:1},8,["schema","state"])}}}),Ge={class:"space-y-6"},ze={class:"flex justify-between items-center"},lt=F({__name:"create",setup(q){const{handleSubmit:V}=Ve(),B=me(),S=async y=>{try{await V(y),I().add({title:"Booking created",description:"Booking has been added successfully",color:"green"}),B.push("/accounting/bookings")}catch{I().add({title:"Error",description:"Failed to create booking",color:"red"})}};return(y,m)=>{const t=pe,g=M,_=Ee,U=ue;return v(),A("div",Ge,[l("div",ze,[m[1]||(m[1]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Add Booking"),l("p",{class:"text-gray-600 dark:text-gray-400"},"Create a new booking payment record")],-1)),n(g,{to:"/accounting/bookings",color:"gray",variant:"outline"},{default:r(()=>[n(t,{name:"i-heroicons-arrow-left",class:"mr-2"}),m[0]||(m[0]=C(" Back to Bookings ",-1))]),_:1,__:[0]})]),n(U,null,{header:r(()=>m[2]||(m[2]=[l("h3",{class:"text-lg font-semibold"},"Booking Details",-1)])),default:r(()=>[n(_,{onSubmit:S})]),_:1})])}}});export{lt as default};
