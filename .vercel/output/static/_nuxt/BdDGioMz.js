import{_ as Q}from"./VnKSk5Dv.js";import{_ as W,a as K}from"./8hJOxu5z.js";import{h as X,l as Z,r as ee,m as te,n as _,i as se,c as u,a as t,b as n,w as o,p as ae,f as ne,o as c,j as l,g as oe,d as g,k as re,t as r,F as h,q as k,s as F,e as le,v as ie}from"./DNOTuklV.js";import"./SYmKFyMt.js";const de={class:"space-y-6"},ue={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},ce={class:"flex justify-end gap-2 mt-4"},me={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"},_e={class:"flex items-center"},ge={class:"p-3 bg-green-100 dark:bg-green-900 rounded-lg"},xe={class:"ml-4"},pe={class:"text-2xl font-bold text-gray-900 dark:text-white"},be={class:"flex items-center"},ye={class:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg"},ve={class:"ml-4"},fe={class:"text-2xl font-bold text-gray-900 dark:text-white"},he={class:"flex items-center"},ke={class:"p-3 bg-red-100 dark:bg-red-900 rounded-lg"},Fe={class:"ml-4"},we={class:"text-2xl font-bold text-gray-900 dark:text-white"},De={class:"flex items-center"},Se={class:"p-3 bg-indigo-100 dark:bg-indigo-900 rounded-lg"},Ue={class:"ml-4"},Ae={class:"text-2xl font-bold text-gray-900 dark:text-white"},Ve={class:"flex items-center"},Be={class:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg"},Pe={class:"ml-4"},Ne={class:"text-2xl font-bold text-gray-900 dark:text-white"},je={class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},Ce={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},Le={class:"space-y-3"},Me={class:"flex justify-between items-center mb-2"},Re={class:"text-sm font-medium text-gray-900 dark:text-white"},Ee={class:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded"},$e={class:"space-y-1"},Ye={class:"flex justify-between items-center"},Ie={class:"text-xs font-medium text-green-600 dark:text-green-400"},ze={class:"flex justify-between items-center"},Oe={class:"text-xs font-medium text-blue-600 dark:text-blue-400"},Te={class:"flex justify-between items-center pt-1 border-t border-gray-200 dark:border-gray-600"},Je={class:"text-xs font-bold text-red-600 dark:text-red-400"},qe={class:"space-y-2"},Ge={class:"text-sm text-gray-600 dark:text-gray-400"},He={class:"font-semibold"},Qe={class:"space-y-2"},We={class:"text-sm text-gray-600 dark:text-gray-400"},Ke={class:"font-semibold"},Xe={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ze={class:"flex justify-between items-center"},et={class:"space-y-3"},tt={class:"font-medium text-gray-900 dark:text-white"},st={class:"text-sm text-gray-500 dark:text-gray-400"},at={class:"text-xs text-gray-400"},nt={class:"text-right"},ot={class:"font-semibold text-green-600 dark:text-green-400"},rt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},lt={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},it={class:"flex justify-between items-center"},dt={class:"space-y-3"},ut={class:"font-medium text-gray-900 dark:text-white"},ct={class:"text-sm text-gray-500 dark:text-gray-400"},mt={class:"text-xs text-gray-400"},_t={class:"text-right"},gt={class:"font-semibold text-red-600 dark:text-red-400"},xt={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},pt={class:"flex justify-between items-center"},bt={class:"space-y-3"},yt={class:"flex items-center"},vt={class:"w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center"},ft={class:"text-blue-600 dark:text-blue-400 font-semibold text-sm"},ht={class:"ml-3 font-medium text-gray-900 dark:text-white"},kt={class:"font-semibold text-gray-900 dark:text-white"},Ft={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Vt=X({__name:"dashboard",setup(wt){const{partners:D,loadPartners:j,loadUnits:C}=Z(),{getDashboardMetrics:L}=ae(),m=ee(null),S=new Date,M=S.getFullYear().toString(),R=(S.getMonth()+1).toString(),i=te({year:M,month:R,partner_id:"",start_date:"",end_date:""}),E=_(()=>{var a;return parseFloat(((a=m.value)==null?void 0:a.metrobnb_revenue)||"0")}),$=_(()=>{var a;return parseFloat(((a=m.value)==null?void 0:a.partner_revenue)||"0")}),Y=_(()=>{var a;return parseFloat(((a=m.value)==null?void 0:a.metrobnb_expenses)||"0")}),I=_(()=>{var a;return parseFloat(((a=m.value)==null?void 0:a.net_profit)||"0")}),U=_(()=>{var a;return((a=m.value)==null?void 0:a.recent_bookings)||[]}),A=_(()=>{var a;return((a=m.value)==null?void 0:a.recent_expenses)||[]}),V=_(()=>{var a;return(((a=m.value)==null?void 0:a.revenue_by_partner)||[]).slice(0,5).map(e=>({id:e.partner_id,name:e.partner_name,earnings:parseFloat(e.revenue)}))}),z=_(()=>{var a;return(((a=m.value)==null?void 0:a.revenue_by_partner)||[]).map(e=>({label:e.partner_name,value:parseFloat(e.revenue),sharePercentage:e.metrobnb_share_percentage,metrobnbShare:parseFloat(e.metrobnb_share_computed),invoiceDue:parseFloat(e.actual_invoice)}))}),O=_(()=>{var a;return(((a=m.value)==null?void 0:a.expense_breakdown)||[]).map(e=>({label:e.type,value:parseFloat(e.amount)}))}),T=_(()=>{var a;return(((a=m.value)==null?void 0:a.monthly_trend)||[]).map(e=>({label:e.month,value:parseFloat(e.metrobnb_revenue)}))}),B=a=>new Date(a).toLocaleDateString(),w=async()=>{try{let a=i.start_date,e=i.end_date;if(i.year||i.month){const y=i.year||new Date().getFullYear(),x=i.month||"";if(x){const d=parseInt(x);a=`${y}-${d.toString().padStart(2,"0")}-01`;const p=new Date(y,d,0).getDate();e=`${y}-${d.toString().padStart(2,"0")}-${p}`}else a=`${y}-01-01`,e=`${y}-12-31`}const b={...i.partner_id&&{partner_id:i.partner_id},...a&&{start_date:a},...e&&{end_date:e}},v=await L(b);m.value=v,console.log("Dashboard loaded:",m.value)}catch(a){console.error("Failed to load dashboard data:",a),m.value=null}},J=_(()=>{const a=[],e=new Date().getFullYear();for(let b=e-5;b<=e+2;b++)a.push({label:b.toString(),value:b.toString()});return[{label:"All Years",value:""},...a.reverse()]}),q=_(()=>[{label:"All Months",value:""},...[{label:"January",value:"1"},{label:"February",value:"2"},{label:"March",value:"3"},{label:"April",value:"4"},{label:"May",value:"5"},{label:"June",value:"6"},{label:"July",value:"7"},{label:"August",value:"8"},{label:"September",value:"9"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}]]),G=_(()=>Array.isArray(D.value)?[{label:"All Partners",value:""},...D.value.map(a=>({label:a.name,value:a.id}))]:[{label:"All Partners",value:""}]),f=()=>{w()},H=()=>{i.year="",i.month="",i.partner_id="",i.start_date="",i.end_date="",w()};return se(async()=>{try{await Promise.all([j(),C(),w()])}catch(a){console.error("Failed to load data:",a)}}),(a,e)=>{const b=Q,v=W,y=K,x=oe,d=ne,p=re,P=le;return c(),u("div",de,[e[34]||(e[34]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Dashboard"),t("p",{class:"text-gray-600 dark:text-gray-400"},"Welcome back! Here's your business overview.")],-1)),n(d,null,{header:o(()=>e[5]||(e[5]=[t("h3",{class:"text-lg font-semibold"},"Filters",-1)])),default:o(()=>[t("div",ue,[n(v,{label:"Year"},{default:o(()=>[n(b,{modelValue:l(i).year,"onUpdate:modelValue":e[0]||(e[0]=s=>l(i).year=s),options:l(J),placeholder:"All years",onChange:f},null,8,["modelValue","options"])]),_:1}),n(v,{label:"Month"},{default:o(()=>[n(b,{modelValue:l(i).month,"onUpdate:modelValue":e[1]||(e[1]=s=>l(i).month=s),options:l(q),placeholder:"All months",onChange:f},null,8,["modelValue","options"])]),_:1}),n(v,{label:"Partner"},{default:o(()=>[n(b,{modelValue:l(i).partner_id,"onUpdate:modelValue":e[2]||(e[2]=s=>l(i).partner_id=s),options:l(G),placeholder:"All partners",onChange:f},null,8,["modelValue","options"])]),_:1}),n(v,{label:"Start Date"},{default:o(()=>[n(y,{modelValue:l(i).start_date,"onUpdate:modelValue":e[3]||(e[3]=s=>l(i).start_date=s),type:"date",onChange:f},null,8,["modelValue"])]),_:1}),n(v,{label:"End Date"},{default:o(()=>[n(y,{modelValue:l(i).end_date,"onUpdate:modelValue":e[4]||(e[4]=s=>l(i).end_date=s),type:"date",onChange:f},null,8,["modelValue"])]),_:1})]),t("div",ce,[n(x,{variant:"ghost",onClick:H},{default:o(()=>e[6]||(e[6]=[g("Clear All",-1)])),_:1,__:[6]}),n(x,{color:"primary",onClick:f},{default:o(()=>e[7]||(e[7]=[g("Apply Filters",-1)])),_:1,__:[7]})])]),_:1}),t("div",me,[n(d,null,{default:o(()=>[t("div",_e,[t("div",ge,[n(p,{name:"i-heroicons-currency-dollar",class:"h-8 w-8 text-green-600 dark:text-green-400"})]),t("div",xe,[e[8]||(e[8]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"MetroBNB Revenue",-1)),t("p",pe,"₱"+r(l(E).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)])])]),_:1}),n(d,null,{default:o(()=>[t("div",be,[t("div",ye,[n(p,{name:"i-heroicons-plus-circle",class:"h-8 w-8 text-blue-600 dark:text-blue-400"})]),t("div",ve,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Partner Revenue",-1)),t("p",fe,"₱"+r(l($).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)])])]),_:1}),n(d,null,{default:o(()=>[t("div",he,[t("div",ke,[n(p,{name:"i-heroicons-minus-circle",class:"h-8 w-8 text-red-600 dark:text-red-400"})]),t("div",Fe,[e[10]||(e[10]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"MetroBNB Expenses",-1)),t("p",we,"₱"+r(l(Y).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)])])]),_:1}),n(d,null,{default:o(()=>[t("div",De,[t("div",Se,[n(p,{name:"i-heroicons-chart-bar-square",class:"h-8 w-8 text-indigo-600 dark:text-indigo-400"})]),t("div",Ue,[e[11]||(e[11]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Net Profit",-1)),t("p",Ae,"₱"+r(l(I).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)])])]),_:1}),n(d,null,{default:o(()=>{var s;return[t("div",Ve,[t("div",Be,[n(p,{name:"i-heroicons-users",class:"h-8 w-8 text-purple-600 dark:text-purple-400"})]),t("div",Pe,[e[12]||(e[12]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Partner Count",-1)),t("p",Ne,r(((s=l(m))==null?void 0:s.partner_count)||0),1)])])]}),_:1})]),n(d,null,{header:o(()=>e[13]||(e[13]=[t("h3",{class:"text-lg font-semibold"},"Quick Actions",-1)])),default:o(()=>[t("div",je,[n(x,{to:"/bookings/create",color:"primary",block:""},{default:o(()=>[n(p,{name:"i-heroicons-plus",class:"mr-2"}),e[14]||(e[14]=g(" New Booking ",-1))]),_:1,__:[14]}),n(x,{to:"/expenses/create",color:"green",block:""},{default:o(()=>[n(p,{name:"i-heroicons-minus",class:"mr-2"}),e[15]||(e[15]=g(" Add Expense ",-1))]),_:1,__:[15]}),n(x,{to:"/partners",color:"blue",block:""},{default:o(()=>[n(p,{name:"i-heroicons-document-text",class:"mr-2"}),e[16]||(e[16]=g(" Generate Invoice ",-1))]),_:1,__:[16]}),n(x,{to:"/partners",color:"purple",block:""},{default:o(()=>[n(p,{name:"i-heroicons-users",class:"mr-2"}),e[17]||(e[17]=g(" Manage Partners ",-1))]),_:1,__:[17]})])]),_:1}),t("div",Ce,[n(d,null,{header:o(()=>e[18]||(e[18]=[t("h3",{class:"text-lg font-semibold"},"Revenue by Partner",-1)])),default:o(()=>[t("div",Le,[(c(!0),u(h,null,k(l(z),s=>(c(),u("div",{key:s.label,class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[t("div",Me,[t("span",Re,r(s.label),1),t("span",Ee,r(s.sharePercentage)+"%",1)]),t("div",$e,[t("div",Ye,[e[19]||(e[19]=t("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"Partner Revenue:",-1)),t("span",Ie,"₱"+r(s.value.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),t("div",ze,[e[20]||(e[20]=t("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"MetroBNB Share:",-1)),t("span",Oe,"₱"+r(s.metrobnbShare.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),t("div",Te,[e[21]||(e[21]=t("span",{class:"text-xs font-medium text-gray-700 dark:text-gray-300"},"Invoice Due:",-1)),t("span",Je,"₱"+r(s.invoiceDue.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)])])]))),128))])]),_:1}),n(d,null,{header:o(()=>e[22]||(e[22]=[t("h3",{class:"text-lg font-semibold"},"Expense Breakdown",-1)])),default:o(()=>[t("div",qe,[(c(!0),u(h,null,k(l(O),s=>(c(),u("div",{key:s.label,class:"flex justify-between items-center"},[t("span",Ge,r(s.label),1),t("span",He,"₱"+r(s.value.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]))),128))])]),_:1})]),n(d,{class:"mb-8"},{header:o(()=>e[23]||(e[23]=[t("h3",{class:"text-lg font-semibold"},"Monthly Revenue Trend",-1)])),default:o(()=>[t("div",Qe,[(c(!0),u(h,null,k(l(T),s=>(c(),u("div",{key:s.label,class:"flex justify-between items-center"},[t("span",We,r(s.label),1),t("span",Ke,"₱"+r(s.value.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]))),128))])]),_:1}),t("div",Xe,[n(d,null,{header:o(()=>[t("div",Ze,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold"},"Recent Bookings",-1)),n(x,{to:"/accounting/bookings",variant:"ghost",size:"sm"},{default:o(()=>e[24]||(e[24]=[g("View All",-1)])),_:1,__:[24]})])]),default:o(()=>[t("div",et,[(c(!0),u(h,null,k(l(U),s=>{var N;return c(),u("div",{key:s.id,class:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[t("div",null,[t("p",tt,r(s.guest_name),1),t("p",st,r(s.unit_name),1),t("p",at,r(B(s.booking_date)),1)]),t("div",nt,[t("span",ot," ₱"+r(parseFloat(s.total_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),(N=s.addons)!=null&&N.length?(c(),u("div",rt," + "+r(s.addons.length)+" add-on"+r(s.addons.length>1?"s":""),1)):F("",!0)])])}),128)),l(U).length?F("",!0):(c(),u("div",lt,[e[27]||(e[27]=g(" No bookings yet. ",-1)),n(P,{to:"/bookings/create",class:"text-blue-600 hover:underline"},{default:o(()=>e[26]||(e[26]=[g("Add your first booking",-1)])),_:1,__:[26]})]))])]),_:1}),n(d,null,{header:o(()=>[t("div",it,[e[29]||(e[29]=t("h3",{class:"text-lg font-semibold"},"Recent Expenses",-1)),n(x,{to:"/expenses",variant:"ghost",size:"sm"},{default:o(()=>e[28]||(e[28]=[g("View All",-1)])),_:1,__:[28]})])]),default:o(()=>[t("div",dt,[(c(!0),u(h,null,k(l(A),s=>(c(),u("div",{key:s.id,class:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[t("div",null,[t("p",ut,r(s.type),1),t("p",ct,r(s.unit_name),1),t("p",mt,r(B(s.date)),1)]),t("div",_t,[t("span",gt," -₱"+r(parseFloat(s.amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),t("div",{class:ie(["text-xs",s.paid?"text-green-500":"text-red-500"])},r(s.paid?"Paid":"Unpaid"),3)])]))),128)),l(A).length?F("",!0):(c(),u("div",xt,[e[31]||(e[31]=g(" No expenses yet. ",-1)),n(P,{to:"/expenses/create",class:"text-blue-600 hover:underline"},{default:o(()=>e[30]||(e[30]=[g("Add your first expense",-1)])),_:1,__:[30]})]))])]),_:1}),n(d,null,{header:o(()=>[t("div",pt,[e[33]||(e[33]=t("h3",{class:"text-lg font-semibold"},"Top Partners",-1)),n(x,{to:"/partners",variant:"ghost",size:"sm"},{default:o(()=>e[32]||(e[32]=[g("View All",-1)])),_:1,__:[32]})])]),default:o(()=>[t("div",bt,[(c(!0),u(h,null,k(l(V),s=>(c(),u("div",{key:s.id,class:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[t("div",yt,[t("div",vt,[t("span",ft,r(s.name.charAt(0)),1)]),t("span",ht,r(s.name),1)]),t("span",kt," ₱"+r(s.earnings.toFixed(2)),1)]))),128)),l(V).length?F("",!0):(c(),u("div",Ft," No partner earnings yet. "))])]),_:1})])])}}});export{Vt as default};
