import{_ as w,h as g,c as E,o as _,D as j,a0 as O,ai as $,G as A,W as J,r as p,i as F,P,aj as Y,R as y}from"./DNOTuklV.js";import{c as k}from"./CAAWyulb.js";class d extends Error{constructor(r){super(r),this.message=r,Object.setPrototypeOf(this,d.prototype)}}const B=g({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:r,emit:n}){const l=J(),o=k(`form-${l}`),u=p(null);F(()=>{o.on(async a=>{var s;a.type!=="submit"&&((s=e.validateOn)!=null&&s.includes(a.type))&&await v(a.path,{silent:!0})})}),P(()=>{o.reset()});const t=p([]);y("form-errors",t),y("form-events",o);const h=p({});y("form-inputs",h);async function S(){let a=await e.validate(e.state);if(e.schema){const{errors:s,result:i}=await N(e.state,e.schema);s?a=a.concat(s):u.value=i}return a}async function v(a,s={silent:!1}){let i=a;if(a&&!Array.isArray(a)&&(i=[a]),i){const f=t.value.filter(c=>!i.includes(c.path)),m=(await S()).filter(c=>i.includes(c.path));t.value=f.concat(m)}else t.value=await S();if(t.value.length>0){if(s.silent)return!1;throw new d(`Form validation failed: ${JSON.stringify(t.value,null,2)}`)}return e.state}async function b(a){var i;const s=a;try{(i=e.validateOn)!=null&&i.includes("submit")&&await v(),s.data=e.schema?u.value:e.state,n("submit",s)}catch(f){if(!(f instanceof d))throw f;const m={...s,errors:t.value.map(c=>({...c,id:h.value[c.path]}))};n("error",m)}}return r({validate:v,errors:t,setErrors(a,s){s?t.value=t.value.filter(i=>i.path!==s).concat(a):t.value=a},async submit(){await b(new Event("submit"))},getErrors(a){return a?t.value.filter(s=>s.path===a):t.value},clear(a){a?t.value=t.value.filter(s=>s.path!==a):t.value=[]}}),{onSubmit:b,errors:Y(t)}}});function I(e){return e.validate&&e.__isYupSchema__}function M(e){return e.inner!==void 0}function R(e){return"schema"in e&&typeof e.coercer=="function"&&typeof e.validator=="function"&&typeof e.refiner=="function"}function U(e){return e.validateAsync!==void 0&&e.id!==void 0}function q(e){return e.isJoi===!0}function x(e){return"~standard"in e}async function z(e,r){const n=await r["~standard"].validate(e);return!n.issues||n.issues.length===0?{errors:null,result:"value"in n?n.value:null}:{errors:n.issues.map(o=>{var u;return{path:((u=o.path)==null?void 0:u.map(t=>typeof t=="object"?t.key:t).join("."))||"",message:o.message}}),result:null}}async function C(e,r){try{return{errors:null,result:await r.validateAsync(e,{abortEarly:!1})}}catch(n){if(q(n))return{errors:n.details.map(o=>({path:o.path.join("."),message:o.message})),result:null};throw n}}async function D(e,r){const[n,l]=r.validate(e);return n?{errors:n.failures().map(u=>({message:u.message,path:u.path.join(".")})),result:null}:{errors:null,result:l}}async function G(e,r){try{return{errors:null,result:await r.validate(e,{abortEarly:!1})}}catch(n){if(M(n))return{errors:n.inner.map(o=>({path:o.path??"",message:o.message})),result:null};throw n}}function N(e,r){if(x(r))return z(e,r);if(U(r))return C(e,r);if(I(r))return G(e,r);if(R(r))return D(e,r);throw new Error("Form validation failed: Unsupported form schema")}function V(e,r,n,l,o,u){return _(),E("form",{onSubmit:r[0]||(r[0]=A((...t)=>e.onSubmit&&e.onSubmit(...t),["prevent"]))},[j(e.$slots,"default",O($({errors:e.errors})))],32)}const K=w(B,[["render",V]]);export{K as _};
